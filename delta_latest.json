{"code":"/** Handle the user message.\n * @param {string} payload the message sent by user\n * @param {AppState} state the state of the app\n * @param {Tool} tools available tools to perform a task\n */\nasync function run(payload, state, tools) {\n  try{\n    if (!state.started){\n      state.started = true;\n      const {yes} = JSON.parse(\n        await tools.yesOrNo(\n          {question: q1,\n          answer: payload}\n        )\n      );\n      if (!yes) {\n        tools.reply('Understood, the game has ended now. Goodbye!');\n        return;\n      }\n    }\n    if (!state.question) {\n    tools.reply(\"Please wait, I'm pulling a post.\")\n    state.text = await tools.fakePost\n      (\n          {userMessage: payload}\n      );\n      tools.reply(state.text);\n      state.question = true;\n      tools.reply(\"Is this piece of news true or false?\");\n    }\n    else {\n      await tof(payload, state, tools);\n      state.question = false;\n    }\n  }\n\n  catch (e) {\n    tools.reply(\"There's something wrong with the code. The program will thus terminate.\");\n  }\n}\n\nasync function tof(payload, state, tools) {\n  const {truth} = JSON.parse(\n    await tools.trueOrFalse(\n      {\n        question: \"Is this piece of news true or false?\",\n        answer: payload\n      }\n      )\n    );\n  if (truth) \n    {\n      state.correct+=1;\n      tools.reply(\"You're wrong!\");\n    }\n  else {\n    tools.reply(\"You're correct!\"); \n    }\n  tools.reply(\"Here's how you can identify where it's fake:\");\n  tools.reply(await tools.explanation({fake_news: state.text}));\n}\n\n\n/** Startup.\n * @param {AppState} state the state of the app\n * @param {Tool} tools available tools to perform a task\n */\nasync function startup(state, tools) {\n  q1= \"I'm designed to test your social media savviness by giving you both fake and real news. Your task is to identify which is fake, and which is real. Are you ready for the challenge?\"\n  tools.reply(q1);\n  state.started = false;\n  state.question = false;\n  state.correct = 0;\n  state.text = '';\n}","llmFunctions":[{"functionName":"yesOrNo","description":"Detect if the answer is yes or no for the question.\n\nFrom this example, you will learn about how you can detect the users' intent from their message. Sometimes it's not as easy as passing the bot the question and the answer and let it guess, you also need to instruct it to think to improve the result.\n\nThis is not the only prompt that works, please feel free to try other prompts and see if you can get better results.\n\nYou can start with making it to only return yes or no to save some tokens.","arguments":["question","answer"],"enableMemory":false,"messageHistory":["memoryPlaceholder",{"role":"system","content":"Your job is to check if the answer is considered yes or no for the question. \nThe answer may not directly answer the question, you have to think, and answer as much as you can. \nIf you still can't determine, just treat it as no. \nReply with the format below in JSON: ###\n{\n  \"reason\": \"\",  // a string describing why you think it's true or false\n  \"yes\": tru, // or false\n}\n###"},{"role":"user","content":"Question: {{question}}\nAnswer: {{answer}}"}],"stream":false,"parameters":{"maxResponse":100,"temperature":0,"topP":0.95,"frequencyPenalty":0,"presencePenalty":0}},{"functionName":"parseNumber","description":"Parse a number from the users' message. You can provide a hint for the bot to better understant the context\n\nWhat happens if you don't tell the bot that the number can be presented in different ways? Give it a try!\n","arguments":["message","hint"],"enableMemory":false,"messageHistory":["memoryPlaceholder",{"role":"system","content":"Your job is to detect a number from the message. \nThe number may be represented in different ways:\n- Arabic numerals.\n- word or character in different languages.\n- adjectives or nouns that reflect a number with given hint, for example, if the hint says the total number is 100, the message \"half\" implies 50.\n\nyou have to think, and answer as good as you can. If you still can't determine, just treat it as 0.\n\nReply with the format below in JSON: ###\n{\n  \"reason\": \"\",  // a string describing why you choose the number\n  \"number\": 0 // Arabic numerals detected\n}\n###"},{"role":"user","content":"Hint: {{hint}}\nMessage: {{message}}"}],"stream":false,"parameters":{"maxResponse":200,"temperature":0,"topP":0.95,"frequencyPenalty":0,"presencePenalty":0}},{"functionName":"translateToLocale","description":"Translate a message to the locale language.","arguments":["message","locale"],"enableMemory":false,"messageHistory":["memoryPlaceholder",{"role":"system","content":"You are a translator. Your job is to translate the message to the locale language. The reply should only contain the translated content."},{"role":"user","content":"Locale: {{locale}}\nMessage: {{message}}"}],"stream":false,"parameters":{"maxResponse":500,"temperature":0.7,"topP":0.95,"frequencyPenalty":0,"presencePenalty":0}},{"functionName":"fakePost","description":"Creates a fake news post intended to spread disinformation","arguments":["userMessage"],"enableMemory":true,"messageHistory":["memoryPlaceholder",{"role":"system","content":"Memorise how many times the user has guessed correctly, by referring to the chat history. Reply with the number of correct guesses by the user. Include a short list of methods that one can use to differentiate your fake news from real news"},{"role":"user","content":"{{userMessage}}"},{"role":"system","content":"Your job is to test this user's social media savviness by creating a summary of a piece of news, along with a source, title, and date written. Do not give any commentary. Keep your reply below 150 words."}],"stream":false,"parameters":{"maxResponse":150,"temperature":0.5,"topP":0.95,"frequencyPenalty":0,"presencePenalty":0},"functions":[]},{"functionName":"trueOrFalse","description":"Detect if the user's answer is true or false for the given question.","arguments":["answer"],"enableMemory":false,"messageHistory":["memoryPlaceholder",{"role":"system","content":"Your job is to check if user's answer is true or false.\nIf you can't determine, just treat it as false. \nReply with the format below in JSON: ###\n{\n  \"reason\": \"\",  // a string describing why you think it's true or false\n  \"truth\": true, // or false\n}\n###"},{"role":"user","content":"Answer: {{answer}}"}],"stream":false,"parameters":{"maxResponse":300,"temperature":0.7,"topP":0.95,"frequencyPenalty":0,"presencePenalty":0},"functions":[]},{"functionName":"explanation","description":"Explains why a given piece of news is false, and shows the user how they can better differentiate fake from real.","arguments":["fake_news"],"enableMemory":false,"messageHistory":["memoryPlaceholder",{"role":"system","content":"Your job is to analyse the user's given piece of fake_news and reply with a numbered list of ways the user can deduce on first glance that the post is fake, giving your reasoning."},{"role":"user","content":"Answer: {{answer}}"}],"stream":false,"parameters":{"maxResponse":300,"temperature":0.7,"topP":0.95,"frequencyPenalty":0,"presencePenalty":0},"functions":[]}]}
